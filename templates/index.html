<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <title>Shotline+ ‚Äî {{ date }}</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, sans-serif;
        background: #111;
        color: #eee;
        text-align: center;
        margin: 0;
      }
      h1 {
        margin: 1em 0 0.5em;
      }
      nav {
        margin-bottom: 1em;
      }

      .hour-block {
        margin: 20px auto;
        width: 90%;
        background: #1c1c1c;
        border-radius: 8px;
        padding: 10px;
      }
      .hour-title {
        font-size: 18px;
        font-weight: bold;
        color: #0ff;
        text-align: left;
        margin-left: 12px;
      }

      img.thumb {
        width: 200px;
        height: auto;
        margin: 6px;
        border-radius: 8px;
        cursor: pointer;
        transition: 0.2s;
      }
      img.thumb:hover {
        transform: scale(1.05);
        box-shadow: 0 0 8px rgba(255, 255, 255, 0.4);
      }

      .modal {
        display: none;
        position: fixed;
        z-index: 99;
        padding-top: 4vh;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.85);
      }
      .modal-content {
        margin: auto;
        display: block;
        width: 75vw;
        height: auto;
        max-height: 90vh;
        border-radius: 12px;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.6);
      }
      #filename {
        color: #ccc;
        margin-top: 10px;
        font-family: monospace;
        font-size: 14px;
      }
      .arrow {
        position: fixed;
        top: 50%;
        font-size: 48px;
        color: #fff;
        cursor: pointer;
        user-select: none;
        opacity: 0.5;
        transition: 0.2s;
      }
      .arrow:hover {
        opacity: 1;
      }
      #leftArrow {
        left: 40px;
      }
      #rightArrow {
        right: 40px;
      }
    </style>
  </head>
  <body>
    <h1>üì∏ Shotline+ ‚Äî {{ date }}</h1>

    <nav>
      {% for d in available_dates %}
      <a
        href="/{{ d }}"
        style="color: {{ 'cyan' if d == date else '#888' }}; margin: 0 6px; text-decoration: none;"
      >
        {{ d }}
      </a>
      {% endfor %}
    </nav>

    {% if shots_by_hour %} {% for hour, shots in shots_by_hour %}
    <div class="hour-block">
      <div class="hour-title">{{ hour }}:00</div>
      {% for f in shots %}
      <img
        src="/screenshots/{{ date }}/{{ f }}"
        class="thumb"
        onclick="openModal('{{ date }}','{{ f }}')"
      />
      {% endfor %}
    </div>
    {% endfor %} {% else %}
    <p>üï≥Ô∏è Ê≤°ÊúâÊâæÂà∞ {{ date }} ÁöÑÊà™Âõæ</p>
    {% endif %}

    <div id="modal" class="modal" onclick="closeModal()">
      <img class="modal-content" id="modalImg" />
      <div id="filename"></div>
      <div
        id="leftArrow"
        class="arrow"
        onclick="event.stopPropagation();prevImage()"
      >
        &#10094;
      </div>
      <div
        id="rightArrow"
        class="arrow"
        onclick="event.stopPropagation();nextImage()"
      >
        &#10095;
      </div>
    </div>

    <script>
            let allShots = [];
            {% for _, shots in shots_by_hour %}
              {% for f in shots %}
                allShots.push("/screenshots/{{ date }}/{{ f }}");
              {% endfor %}
            {% endfor %}
            let currentIndex = -1;

            function openModal(date, filename) {
              const src = `/screenshots/${date}/${filename}`;
              currentIndex = allShots.indexOf(src);
              const modal = document.getElementById('modal');
              const img = document.getElementById('modalImg');
              const fn = document.getElementById('filename');
              img.src = src;
              fn.textContent = filename;
              modal.style.display = 'block';
            }
            function closeModal() {
              document.getElementById('modal').style.display = 'none';
            }
            function showImage(i) {
              if (i < 0 || i >= allShots.length) return;
              currentIndex = i;
              const img = document.getElementById('modalImg');
              const fn = document.getElementById('filename');
              img.src = allShots[i];
              const parts = allShots[i].split('/');
              fn.textContent = parts[parts.length - 1];
            }
            function nextImage() {
        if (currentIndex + 1 < allShots.length) {
          showImage(currentIndex + 1);
        } else {
          // Â∑≤Âà∞ÊúÄÂêé‰∏ÄÂº† ‚Üí Â∞ùËØïË∑≥Âà∞‰∏ã‰∏ÄÂ∞èÊó∂ÔºàÂç≥‰∏ä‰∏ÄÁªÑÔºåÂõ†‰∏∫ÊåâÂ∞èÊó∂ÂÄíÂ∫èÊòæÁ§∫Ôºâ
          const dateLinks = [...document.querySelectorAll('.hour-title')];
          const currentHour = allShots[currentIndex].match(/(\d{2})-\d{2}-\d{2}/);
          if (!currentHour) return;
          const currentHourNum = parseInt(currentHour[1]);
          const nextHourBlock = dateLinks.find(h => parseInt(h.textContent) < currentHourNum);
          if (nextHourBlock) {
            nextHourBlock.scrollIntoView({ behavior: 'smooth', block: 'center' });
          }
        }
      }

      function prevImage() {
        if (currentIndex - 1 >= 0) {
          showImage(currentIndex - 1);
        } else {
          // Â∑≤Âà∞Á¨¨‰∏ÄÂº† ‚Üí Ë∑≥Âà∞‰∏ä‰∏ÄÂ∞èÊó∂
          const dateLinks = [...document.querySelectorAll('.hour-title')];
          const currentHour = allShots[currentIndex].match(/(\d{2})-\d{2}-\d{2}/);
          if (!currentHour) return;
          const currentHourNum = parseInt(currentHour[1]);
          const prevHourBlock = dateLinks.find(h => parseInt(h.textContent) > currentHourNum);
          if (prevHourBlock) {
            prevHourBlock.scrollIntoView({ behavior: 'smooth', block: 'center' });
          }
        }
      }


            document.addEventListener('keydown', (e) => {
              if (document.getElementById('modal').style.display !== 'block') return;
              if (e.key === 'ArrowRight') nextImage();
              if (e.key === 'ArrowLeft') prevImage();
              if (e.key === 'Escape') closeModal();
            });
    </script>
  </body>
</html>
